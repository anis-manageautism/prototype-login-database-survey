<h2>Your Dashboard</h2>
<p id="email"></p>

<a id="survey" target="_blank">Take the survey</a>

<div id="responses"></div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient(
    "https://wnpedjydocptfkfkrhmr.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InducGVkanlkb2NwdGZrZmtyaG1yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA0MDI4MTksImV4cCI6MjA4NTk3ODgxOX0.QtbxxivzmTRd8fGN5Lr5S0fNZOw-x6Ev3_cpyWoXhqo"
  );

  async function load() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      window.location = "index.html";
      return;
    }

    document.getElementById("email").innerText = user.email;

    // Prefilled Google Form
    const formUrl =
  "https://docs.google.com/forms/d/e/1oIt02qxA7EJ6x8W4DxYNFAaHimqkvfXGzA1bKxwmQpQ/viewform";
      encodeURIComponent(user.email);

    document.getElementById("survey").href = formUrl;

    // Fetch survey data
    const res = await fetch(
      `https://script.google.com/macros/s/AKfycby1CWeC4MHJP6Wbs7-AMDqw-WqQyFi-sICnpidK0cKb-EegUMJ3G55ierFcjOTYnN7grg/exec?email=${encodeURIComponent(user.email)}`
    );
    const data = await res.json();

    document.getElementById("responses").innerHTML =
      "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
  }

  load();
</script>
