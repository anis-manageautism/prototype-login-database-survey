<h2>Your Dashboard</h2>
<p id="email"></p>

<a id="survey" target="_blank">Take the survey</a>

<div id="responses"></div>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const supabase = supabase.createClient(
    "YOUR_SUPABASE_URL",
    "YOUR_PUBLIC_ANON_KEY"
  );

  async function load() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      window.location = "index.html";
      return;
    }

    document.getElementById("email").innerText = user.email;

    // Prefilled Google Form
    const formUrl =
      "https://docs.google.com/forms/d/e/FORM_ID/viewform?usp=pp_url&entry.EMAIL_FIELD_ID=" +
      encodeURIComponent(user.email);

    document.getElementById("survey").href = formUrl;

    // Fetch survey data
    const res = await fetch(
      `https://YOUR_SCRIPT_URL/exec?email=${encodeURIComponent(user.email)}`
    );
    const data = await res.json();

    document.getElementById("responses").innerHTML =
      "<pre>" + JSON.stringify(data, null, 2) + "</pre>";
  }

  load();
</script>
